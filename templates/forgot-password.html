{# Extend the base layout template (navbar, footer, etc.) #}
{% extends "base.html" %}

{# Set the page title shown in the browser tab #}
{% block title %}Forgot Password{% endblock %}

{# Page-specific CSS block #}
{% block extra_css %}
<!-- Link to the forgot-password page stylesheet -->
<link rel="stylesheet" href="{{ url_for('static', filename='forgot-password.css') }}">
{% endblock %}

{# Main content block #}
{% block content %}

<!-- Center the form horizontally using Bootstrap grid -->
<div class="row justify-content-center">
  <!-- Column with medium width -->
  <div class="col-md-6">

    <!-- Page heading -->
    <h1 class="mb-4">Reset your password</h1>

    <!-- Instruction text -->
    <p class="mb-4">
      Enter the email associated with your account and we'll send you a reset link.
    </p>

    <!-- Card container for the form -->
    <div class="card">
      <!-- Card body -->
      <div class="card-body">

        <!-- Forgot password form -->
        <form id="forgotPasswordForm">

          <!-- Email input field -->
          <div class="mb-3">
            <!-- Label for email input -->
            <label for="email" class="form-label">Email address</label>
            <!-- Email input (required) -->
            <input type="email" class="form-control" id="email" required>
          </div>

          <!-- Submit button -->
          <button type="submit" class="btn btn-primary">
            <!-- Envelope icon -->
            <i class="bi bi-envelope"></i> Send reset link
          </button>
        </form>

        <!-- Area where success/error messages will be displayed -->
        <div id="message" class="mt-3"></div>
      </div>
    </div>

    <!-- Link back to login page -->
    <p class="mt-3">
      <a href="{{ url_for('pages.log_in') }}">Back to sign in</a>
    </p>
  </div>
</div>

{# End of main content block #}
{% endblock %}

{# Page-specific JavaScript block #}
{% block extra_js %}
<script>
/* Run JavaScript after the page content has fully loaded */
document.addEventListener("DOMContentLoaded", function() {

  /* Attach submit event listener to the forgot password form */
  document.getElementById("forgotPasswordForm").addEventListener("submit", function(e) {

    /* Prevent default form submission (page reload) */
    e.preventDefault();

    /* Get the email entered by the user */
    const email = document.getElementById("email").value;

    /* Get the message display element */
    const messageEl = document.getElementById("message");
    
    /* Show loading message while processing */
    messageEl.innerHTML = '<div class="alert alert-info">Processing...</div>';
    
    /* Send POST request to forgot-password API */
    fetch("/api/forgot-password", {

      /* HTTP method */
      method: "POST",

      /* Set request headers */
      headers: { "Content-Type": "application/json" },

      /* Send email as JSON in request body */
      body: JSON.stringify({ email: email })
    })
    .then(res => {
      /* Parse response JSON and keep status info */
      return res.json().then(data => ({ status: res.ok, data: data }));
    })
    .then(result => {
      /* Show success message */
      messageEl.innerHTML =
        '<div class="alert alert-success">' +
        '<i class="bi bi-check-circle"></i> ' +
        'Check terminal for reset link.</div>';
    })
    .catch(err => {
      /* Show error message if request fails */
      messageEl.innerHTML =
        '<div class="alert alert-danger">Error processing request</div>';

      /* Log error to browser console */
      console.error(err);
    });
  });
});
</script>
{% endblock %}
