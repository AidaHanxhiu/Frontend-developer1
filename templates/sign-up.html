{# Extend the base layout template (navbar, footer, shared layout) #}
{% extends "base.html" %}

{# Set the page title shown in the browser tab #}
{% block title %}Sign Up{% endblock %}

{# Page-specific CSS block #}
{% block extra_css %}
<!-- Link to the stylesheet for the sign-up page -->
<link rel="stylesheet" href="{{ url_for('static', filename='sign-up.css') }}">
{% endblock %}

{# Main content block #}
{% block content %}

<!-- Page heading -->
<h1>Create your account</h1>

<!-- Sign-up form -->
<form id="signup-form" class="signup-form">

    <!-- First name label -->
    <label>First name</label>

    <!-- First name input (required) -->
    <input id="first_name" name="first_name" required>

    <!-- Last name label -->
    <label>Last name</label>

    <!-- Last name input (required) -->
    <input id="last_name" name="last_name" required>

    <!-- Email label -->
    <label>Email</label>

    <!-- Email input (required, must be valid email format) -->
    <input id="email" name="email" type="email" required>

    <!-- Password label -->
    <label>Password</label>

    <!-- Password input (minimum length 6 characters) -->
    <input id="password" name="password" type="password" minlength="6" required>

    <!-- Terms and conditions checkbox -->
    <label class="checkbox">

        <!-- Checkbox input (required) -->
        <input id="terms" type="checkbox" required>

        <!-- Terms agreement text -->
        I agree to the terms
    </label>

    <!-- Submit button -->
    <button type="submit" class="btn-primary">
      Create Account
    </button>
</form>

<!-- Message area for sign-up feedback -->
<p id="signup-message" style="margin-top: 10px;"></p>

<!-- Link to login page for existing users -->
<p style="margin-top: 15px;">
    Already have an account?
    <a href="{{ url_for('pages.log_in') }}">Sign in</a>
</p>

{# End of main content block #}
{% endblock %}

{# Page-specific JavaScript block #}
{% block extra_js %}
<script>
/* Run JavaScript after the DOM is fully loaded */
document.addEventListener("DOMContentLoaded", function () {

    /* Get reference to the sign-up form */
    const form = document.getElementById("signup-form");

    /* Get reference to the message display element */
    const msg = document.getElementById("signup-message");

    /* Get reference to the terms checkbox */
    const terms = document.getElementById("terms");

    /* Handle form submission */
    form.addEventListener("submit", async function (event) {

        /* Prevent default form submission */
        event.preventDefault();

        /* Clear previous messages */
        msg.textContent = "";
        msg.style.color = "black";

        /* Check if user agreed to terms */
        if (!terms.checked) {

            /* Show error message */
            msg.textContent = "You must agree to the terms.";
            msg.style.color = "red";
            return;
        }

        /* Build request payload from form inputs */
        const payload = {
            first_name: document.getElementById("first_name").value,
            last_name:  document.getElementById("last_name").value,
            email:      document.getElementById("email").value,
            password:   document.getElementById("password").value,
        };

        /* Show loading message */
        msg.textContent = "Creating account...";

        try {
            /* Send POST request to signup API */
            const response = await fetch("/api/signup", {

                /* HTTP method */
                method: "POST",

                /* Set request headers */
                headers: { "Content-Type": "application/json" },

                /* Send payload as JSON */
                body: JSON.stringify(payload),
            });

            /* Parse JSON response */
            const data = await response.json();

            /* If account creation was successful */
            if (response.ok) {

                /* Show success message */
                msg.textContent = data.message || "Account created!";
                msg.style.color = "green";

                /* Redirect to login page after delay */
                setTimeout(() => {
                    window.location.href = "/log-in";
                }, 1500);

            } else {

                /* Show error message returned by backend */
                msg.textContent = data.message || "Sign up failed";
                msg.style.color = "red";
            }

        } catch (error) {

            /* Handle network or server errors */
            msg.textContent = "Error connecting to server";
            msg.style.color = "red";
        }
    });
});
</script>
{% endblock %}
